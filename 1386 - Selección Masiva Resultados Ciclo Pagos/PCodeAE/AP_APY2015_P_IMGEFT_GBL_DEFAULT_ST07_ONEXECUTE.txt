Declare Function fnextorprevbusinessdatecountry PeopleCode FUNCLIB_BUS_CAL.BUS_CAL_FUNCTIONS FieldFormula;
Local date &tempdate;

SQLExec("SELECT SETTLEMENT_DAYS FROM PS_PYMNT_FMT_TBL WHERE SETID = :1 AND EFT_PYMNT_FMT_CD = :2", AP_PAYSELCT_AET.BANK_SETID, AP_PAYSELCT_AET.EFT_PYMNT_FMT_CD, &nDays);
&tempdate = AP_PAYSELCT_AET.PYMNT_DT;

SQLExec("SELECT HOL_PROC_LVL, HOLIDAY_LIST_ID FROM PS_BUS_UNIT_TBL_AP WHERE BUSINESS_UNIT =:1", AP_PAYSELCT_AET.BUSINESS_UNIT, &HOL_PROC_LVL, &HOLIDAY_LIST_ID);

If &HOL_PROC_LVL = "B" Then
   SQLExec("SELECT HOLIDAY_LIST_ID FROM PS_BANK_CD_TBL WHERE SETID = :1 AND BANK_CD = :2", AP_PAYSELCT_AET.BANK_SETID, AP_PAYSELCT_AET.BANK_CD, &HOLIDAY_LIST_ID);
End-If;

&HOLLISTARRAY = CreateArray(&TEMPSTR);
&HOLLISTARRAY [1] = &HOLIDAY_LIST_ID;

While &nDays <> 0
   &tempdate = &tempdate + 1;
   &tempdate = fnextorprevbusinessdatecountry(&tempdate, &HOLLISTARRAY, 1);
   &nDays = &nDays - 1;
End-While;

AP_PAYSELCT_AET.STTLMNT_DT_EST = &tempdate;