Function Insert_pycycl_statrpt();
   Local string &goodCount;
   /* Set Report Name */
   Evaluate AP_PAYSELCT_AET.PYMNT_METHOD
   When = "CHK"
   When = "EFT"
   When = "WIR"
   When = "ACH"
   When = "BEF"
   When = "GE"
   When = "LC"
      PYCYCL_2_AET.FILE_EXTENSION = AP_PAYSELCT_AET.PYMNT_METHOD
   When = "BOO"
      PYCYCL_2_AET.FILE_EXTENSION = "DFT";
   End-Evaluate;
   
   SQLExec("SELECT OUTDESTFORMAT FROM PS_PRCSDEFN WHERE PRCSNAME = 'APY2021-'", &OUTDESTFORMAT);
   
   &FORMAT = ".NONE";
   
   Evaluate &OUTDESTFORMAT
   When = "0"
   When = "1"
   When = "11"
   When = "15"
   When = "16"
   When = "19"
   When = "21"
      &FORMAT = ".RPT";
      Break
   When = "10"
   When = "4"
   When = "6"
      &FORMAT = ".LIS";
      Break
   When = "12"
      &FORMAT = ".RTF";
      Break
   When = "13"
      &FORMAT = ".SPF";
      Break
   When = "14"
      &FORMAT = ".TXT";
      Break
   When = "17"
      &FORMAT = ".XML";
      Break
   When = "18"
      &FORMAT = ".DAT";
      Break
   When = "2"
      &FORMAT = ".PDF";
      Break
   When = "20"
      &FORMAT = ".XML";
      Break
   When = "3"
      &FORMAT = ".CSV";
      Break
   When = "5"
      &FORMAT = ".HTM";
      Break
   When = "8"
      &FORMAT = ".XLS";
      Break
   When = "9"
      &FORMAT = ".DOC";
      Break
   End-Evaluate;
   
   
   Evaluate AP_PAYSELCT_AET.PRINT_TYPE
   When = "P"
      PYCYCL_2_AET.FORM_LAYOUT = "PM";
      AP_PAYSELCT_AET.REPORT_NAME = RTrim(PYCYCL_2_AET.FILE_EXTENSION) | RTrim(AP_PAYSELCT_AET.BANK_CD) | RTrim(AP_PAYSELCT_AET.BANK_ACCT_KEY) | "PM" | &FORMAT;
      Break;
   When = "C"
      PYCYCL_2_AET.FORM_LAYOUT = "CP";
      AP_PAYSELCT_AET.REPORT_NAME = RTrim(PYCYCL_2_AET.FILE_EXTENSION) | RTrim(AP_PAYSELCT_AET.BANK_CD) | RTrim(AP_PAYSELCT_AET.BANK_ACCT_KEY) | "CP.TXT";
      Break;
   When = "A"
      PYCYCL_2_AET.FORM_LAYOUT = "AD";
      AP_PAYSELCT_AET.REPORT_NAME = RTrim(PYCYCL_2_AET.FILE_EXTENSION) | RTrim(AP_PAYSELCT_AET.BANK_CD) | RTrim(AP_PAYSELCT_AET.BANK_ACCT_KEY) | "AD" | &FORMAT;
      Break;
   When = "F"
      PYCYCL_2_AET.FORM_LAYOUT = "PM";
      AP_PAYSELCT_AET.REPORT_NAME = RTrim(PYCYCL_2_AET.FILE_EXTENSION) | RTrim(AP_PAYSELCT_AET.BANK_CD) | RTrim(AP_PAYSELCT_AET.BANK_ACCT_KEY) | "PM.TXT";
      Break;
   When-Other
      PYCYCL_2_AET.FORM_LAYOUT = "PM";
      AP_PAYSELCT_AET.REPORT_NAME = RTrim(PYCYCL_2_AET.FILE_EXTENSION) | RTrim(AP_PAYSELCT_AET.BANK_CD) | RTrim(AP_PAYSELCT_AET.BANK_ACCT_KEY) | "PM" | &FORMAT;
      Break;
   End-Evaluate;
   
   /* Set Print Switch */
   AP_PAYSELCT_AET.PRINT_SWITCH = "N";
   If AP_PAYSELCT_AET.PRINT_TYPE = "F" Then
      Evaluate AP_PAYSELCT_AET.RPT_PYMNT_METHOD
      When = "CHK"
      When = "BOO"
      When = "LC"
      When = "WIR"
      When = "BEF"
         AP_PAYSELCT_AET.PRINT_SWITCH = "Y";
      End-Evaluate;
   End-If;
   AP_PAYSELCT_AET.DUMMY_FIELD = " ";
   &goodCount = "X";
   SQLExec("SELECT 'X' FROM PS_PYCYCL_STATRPT WHERE PAY_CYCLE = :1 AND PAY_CYCLE_SEQ_NUM = :2 AND BANK_SETID = :3 AND BANK_CD = :4 AND BANK_ACCT_KEY = :5 AND PYMNT_METHOD = :6 AND PYMNT_FILENAME = :7", AP_PAYSELCT_AET.PAY_CYCLE, AP_PAYSELCT_AET.PAY_CYCLE_SEQ_NUM, AP_PAYSELCT_AET.RPT_BANK_SETID, AP_PAYSELCT_AET.RPT_BANK_CD, AP_PAYSELCT_AET.RPT_BANK_ACCT_KEY, AP_PAYSELCT_AET.RPT_PYMNT_METHOD, AP_PAYSELCT_AET.REPORT_NAME, AP_PAYSELCT_AET.DUMMY_FIELD);
   /**Check to see if there is no work to process**/
   If AP_PAYSELCT_AET.ERRORS_FLG = "Y" Then
      &goodCount = "Y";
      /*INICIO CHGA 001*/
      REM BY CHGA       SQLExec("SELECT 'X' FROM %Table(PYCYCL_01_TMP) A WHERE A.PAY_CYCLE= :1 AND A.PAY_CYCLE_SEQ_NUM= :2 AND A.BANK_SETID = :3 AND A.BANK_CD = :4 AND A.BANK_ACCT_KEY = :5 AND A.PYMNT_METHOD = :6 AND A.PYMNT_SELCT_STATUS IN ('P', 'R')", AP_PAYSELCT_AET.PAY_CYCLE, AP_PAYSELCT_AET.PAY_CYCLE_SEQ_NUM, AP_PAYSELCT_AET.RPT_BANK_SETID, AP_PAYSELCT_AET.RPT_BANK_CD, AP_PAYSELCT_AET.RPT_BANK_ACCT_KEY, AP_PAYSELCT_AET.RPT_PYMNT_METHOD, &goodCount);
      
      SQLExec("SELECT 'X' FROM %Table(PYCYCL_01_TMP) A WHERE A.PAY_CYCLE= :1 AND A.PAY_CYCLE_SEQ_NUM= :2 AND A.BANK_SETID = :3 AND A.BANK_CD = :4 AND A.BANK_ACCT_KEY = :5 AND A.PYMNT_METHOD = :6 AND A.FF_DET_PAGO = :7 AND A.PYMNT_SELCT_STATUS IN ('P', 'R')", AP_PAYSELCT_AET.PAY_CYCLE, AP_PAYSELCT_AET.PAY_CYCLE_SEQ_NUM, AP_PAYSELCT_AET.RPT_BANK_SETID, AP_PAYSELCT_AET.RPT_BANK_CD, AP_PAYSELCT_AET.RPT_BANK_ACCT_KEY, AP_PAYSELCT_AET.RPT_PYMNT_METHOD, AP_PAYSELCT_AET.FF_DET_PAGO, &goodCount);
      
      /*FIN CHGA 001*/
   End-If;
   
   If AP_PAYSELCT_AET.DUMMY_FIELD <> "X" And
         &goodCount = "X" Then
      SQLExec("INSERT INTO PS_PYCYCL_STATRPT (PAY_CYCLE, PAY_CYCLE_SEQ_NUM, PAY_RUN_AP_STATUS, BANK_SETID, BANK_CD, BANK_ACCT_KEY, PYMNT_METHOD, PYMNT_FILENAME, FORM_TYPE, PRINT_SWITCH, FIRST_PYMNT_REF_ID, OUTDEST, OUTDESTTYPE , SERVERNAME, STL_THROUGH) VALUES (:1,:2,:3,:4,:5,:6,:7,:8,:9,:10,' ' ,' ' ,' ' ,' ','02')", AP_PAYSELCT_AET.PAY_CYCLE, AP_PAYSELCT_AET.PAY_CYCLE_SEQ_NUM, AP_PAYSELCT_AET.PAY_RUN_AP_STATUS, AP_PAYSELCT_AET.RPT_BANK_SETID, AP_PAYSELCT_AET.RPT_BANK_CD, AP_PAYSELCT_AET.RPT_BANK_ACCT_KEY, AP_PAYSELCT_AET.RPT_PYMNT_METHOD, AP_PAYSELCT_AET.REPORT_NAME, AP_PAYSELCT_AET.FORM_TYPE, AP_PAYSELCT_AET.PRINT_SWITCH);
   End-If;
End-Function;

/* Main */
If AP_PAYSELCT_AET.RPT_MODE = "N" Then
   AP_PAYSELCT_AET.RPT_BANK_SETID = AP_PAYSELCT_AET.BANK_SETID;
   AP_PAYSELCT_AET.RPT_BANK_CD = AP_PAYSELCT_AET.BANK_CD;
   AP_PAYSELCT_AET.RPT_BANK_ACCT_KEY = AP_PAYSELCT_AET.BANK_ACCT_KEY;
   AP_PAYSELCT_AET.RPT_PYMNT_METHOD = AP_PAYSELCT_AET.PYMNT_METHOD;
Else
   AP_PAYSELCT_AET.RPT_BANK_SETID = AP_PAYSELCT_AET.EFT_BANK_SETID;
   AP_PAYSELCT_AET.RPT_BANK_CD = AP_PAYSELCT_AET.EFT_BANK_CD;
   AP_PAYSELCT_AET.RPT_BANK_ACCT_KEY = AP_PAYSELCT_AET.EFT_BANK_ACCT_KEY;
   AP_PAYSELCT_AET.RPT_PYMNT_METHOD = AP_PAYSELCT_AET.PYMNT_METHOD;
End-If;
If PYCYCL_3_AET.TRIAL_REG_FLG.Value = "U" Then
   AP_PAYSELCT_AET.PAY_RUN_AP_STATUS.Value = "U";
Else
   AP_PAYSELCT_AET.PAY_RUN_AP_STATUS.Value = "V";
End-If;
Evaluate AP_PAYSELCT_AET.FORM_TYPE
When = "CSO"
When = "SCO"
When = "ADV"
When = "CRW"
When = "LCA"
When = "SCA"
When = "CSA"
When = "CAV"
When = "CRA"
   AP_PAYSELCT_AET.PRINT_TYPE = "P";
   Insert_pycycl_statrpt();
   If AP_PAYSELCT_AET.FILE_COPY_FLG = "Y" Then
      AP_PAYSELCT_AET.PRINT_TYPE = "C";
      Insert_pycycl_statrpt();
   End-If;
   If AP_PAYSELCT_AET.FORM_TYPE = "SCA" Or
         AP_PAYSELCT_AET.FORM_TYPE = "CSA" Then
      If AP_PAYSELCT_AET.ADVICE_EXISTS = "Y" Then
         AP_PAYSELCT_AET.PRINT_TYPE = "A";
         Insert_pycycl_statrpt();
      End-If;
   End-If;
   If AP_PAYSELCT_AET.FORM_TYPE = "CAV" Or
         AP_PAYSELCT_AET.FORM_TYPE = "CRA" Then
      AP_PAYSELCT_AET.ADVICE_EXISTS = "Y";
      AP_PAYSELCT_AET.PRINT_TYPE = "A";
      Insert_pycycl_statrpt();
   End-If;
   Break;
When = "EFT"
When = "ACH"
When = "BEF"
When = "GEF"
When = "EFA"
When = "BEA"
When = "GEA"
   AP_PAYSELCT_AET.PRINT_TYPE = "F";
   Insert_pycycl_statrpt();
   If AP_PAYSELCT_AET.FORM_TYPE = "EFA" Or
         AP_PAYSELCT_AET.FORM_TYPE = "BEA" Or
         AP_PAYSELCT_AET.FORM_TYPE = "GEA" Then
      AP_PAYSELCT_AET.ADVICE_EXISTS = "Y";
      AP_PAYSELCT_AET.PRINT_TYPE = "A";
      Insert_pycycl_statrpt();
   End-If;
   Break;
When-Other
   Break;
End-Evaluate;
