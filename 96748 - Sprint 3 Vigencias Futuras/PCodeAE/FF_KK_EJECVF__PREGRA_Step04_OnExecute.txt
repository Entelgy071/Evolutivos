Local Rowset &rs_FF_TMP_DAT;

&rs_FF_TMP_DAT = CreateRowset(Record.FF_TMP_DAT);

&rs_FF_TMP_DAT.Fill(" WHERE PROCESS_INSTANCE = :1", FF_KK_EJEC_AET.PROCESS_INSTANCE);

For &i = 1 To &rs_FF_TMP_DAT.ActiveRowCount
   
   SQLExec("SELECT SUM(B.MONETARY_AMOUNT_CC) - SUM(B.MONETARY_AMOUNT) FROM PS_ETY_KKDR_LOG_VW B WHERE B.BUSINESS_UNIT = :1 AND B.LEDGER = 'KK_FID_PRE' AND B.ACCOUNT = :2 AND B.DEPTID = :3 AND B.PROJECT_ID = :4 AND B.FISCAL_YEAR = :5 AND EXTRACT(MONTH FROM B.PROCESS_DATE) > :6 AND B.ACCOUNTING_PERIOD <= :6", FF_KK_EJEC_AET.BUSINESS_UNIT, &rs_FF_TMP_DAT(&i).FF_TMP_DAT.ACCOUNT.Value, &rs_FF_TMP_DAT(&i).FF_TMP_DAT.DEPTID.Value, &rs_FF_TMP_DAT(&i).FF_TMP_DAT.PROJECT_ID.Value, FF_KK_EJEC_AET.FISCAL_YEAR, FF_KK_EJEC_AET.ACCOUNTING_PERIOD, &num_MONETARY_AMOUNT);
   
   If All(&num_MONETARY_AMOUNT) Then
      SQLExec("UPDATE %TABLE(FF_TMP_DAT) SET MONETARY_AMOUNT = MONETARY_AMOUNT + :1 WHERE ACCOUNT = :2 AND DEPTID = :3 AND PROJECT_ID = :4", &num_MONETARY_AMOUNT, &rs_FF_TMP_DAT(&i).FF_TMP_DAT.ACCOUNT.Value, &rs_FF_TMP_DAT(&i).FF_TMP_DAT.DEPTID.Value, &rs_FF_TMP_DAT(&i).FF_TMP_DAT.PROJECT_ID.Value);
   End-If;
   
End-For;
